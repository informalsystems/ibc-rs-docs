<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Computes the voting power in a commit against a validator set."><title>VotingPowerCalculator in tendermint_light_client_verifier::operations::voting_power - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../../static.files/rustdoc-b0742ba02757f159.css"><meta name="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="tendermint_light_client_verifier" data-themes="" data-resource-suffix="" data-rustdoc-version="1.84.0-nightly (9322d183f 2024-10-14)" data-channel="nightly" data-search-js="search-e056c65ede92db13.js" data-settings-js="settings-805db61a62df4bd2.js" ><script src="../../../static.files/storage-1d39b6787ed640ff.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../../static.files/main-f070b9041d14864c.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-0111fcff984fae8f.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../tendermint_light_client_verifier/index.html">tendermint_<wbr>light_<wbr>client_<wbr>verifier</a><span class="version">0.40.0</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Voting<wbr>Power<wbr>Calculator</a></h2><h3><a href="#required-methods">Required Methods</a></h3><ul class="block"><li><a href="#tymethod.voting_power_in" title="voting_power_in">voting_power_in</a></li><li><a href="#tymethod.voting_power_in_sets" title="voting_power_in_sets">voting_power_in_sets</a></li></ul><h3><a href="#provided-methods">Provided Methods</a></h3><ul class="block"><li><a href="#method.check_enough_trust_and_signers" title="check_enough_trust_and_signers">check_enough_trust_and_signers</a></li><li><a href="#method.check_signers_overlap" title="check_signers_overlap">check_signers_overlap</a></li><li><a href="#method.total_power_of" title="total_power_of">total_power_of</a></li></ul><h3><a href="#implementors">Implementors</a></h3></section><div id="rustdoc-modnav"><h2><a href="index.html">In tendermint_<wbr>light_<wbr>client_<wbr>verifier::<wbr>operations::<wbr>voting_<wbr>power</a></h2></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><span class="rustdoc-breadcrumbs"><a href="../../index.html">tendermint_light_client_verifier</a>::<wbr><a href="../index.html">operations</a>::<wbr><a href="index.html">voting_power</a></span><h1>Trait <span class="trait">VotingPowerCalculator</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../../src/tendermint_light_client_verifier/operations/voting_power.rs.html#75-184">source</a> </span></div><pre class="rust item-decl"><code>pub trait VotingPowerCalculator: <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Send.html" title="trait core::marker::Send">Send</a> + <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sync.html" title="trait core::marker::Sync">Sync</a> {
    // Required methods
    fn <a href="#tymethod.voting_power_in" class="fn">voting_power_in</a>(
        &amp;self,
        signed_header: &amp;<a class="type" href="../../types/type.SignedHeader.html" title="type tendermint_light_client_verifier::types::SignedHeader">SignedHeader</a>,
        validator_set: &amp;<a class="type" href="../../types/type.ValidatorSet.html" title="type tendermint_light_client_verifier::types::ValidatorSet">ValidatorSet</a>,
        trust_threshold: <a class="type" href="../../types/type.TrustThreshold.html" title="type tendermint_light_client_verifier::types::TrustThreshold">TrustThreshold</a>,
    ) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="struct.VotingPowerTally.html" title="struct tendermint_light_client_verifier::operations::voting_power::VotingPowerTally">VotingPowerTally</a>, <a class="struct" href="../../errors/struct.VerificationError.html" title="struct tendermint_light_client_verifier::errors::VerificationError">VerificationError</a>&gt;;
<span class="item-spacer"></span>    fn <a href="#tymethod.voting_power_in_sets" class="fn">voting_power_in_sets</a>(
        &amp;self,
        signed_header: &amp;<a class="type" href="../../types/type.SignedHeader.html" title="type tendermint_light_client_verifier::types::SignedHeader">SignedHeader</a>,
        first_set: (&amp;<a class="type" href="../../types/type.ValidatorSet.html" title="type tendermint_light_client_verifier::types::ValidatorSet">ValidatorSet</a>, <a class="type" href="../../types/type.TrustThreshold.html" title="type tendermint_light_client_verifier::types::TrustThreshold">TrustThreshold</a>),
        second_set: (&amp;<a class="type" href="../../types/type.ValidatorSet.html" title="type tendermint_light_client_verifier::types::ValidatorSet">ValidatorSet</a>, <a class="type" href="../../types/type.TrustThreshold.html" title="type tendermint_light_client_verifier::types::TrustThreshold">TrustThreshold</a>),
    ) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;(<a class="struct" href="struct.VotingPowerTally.html" title="struct tendermint_light_client_verifier::operations::voting_power::VotingPowerTally">VotingPowerTally</a>, <a class="struct" href="struct.VotingPowerTally.html" title="struct tendermint_light_client_verifier::operations::voting_power::VotingPowerTally">VotingPowerTally</a>), <a class="struct" href="../../errors/struct.VerificationError.html" title="struct tendermint_light_client_verifier::errors::VerificationError">VerificationError</a>&gt;;

    // Provided methods
    fn <a href="#method.total_power_of" class="fn">total_power_of</a>(&amp;self, validator_set: &amp;<a class="type" href="../../types/type.ValidatorSet.html" title="type tendermint_light_client_verifier::types::ValidatorSet">ValidatorSet</a>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u64.html">u64</a> { ... }
<span class="item-spacer"></span>    fn <a href="#method.check_enough_trust_and_signers" class="fn">check_enough_trust_and_signers</a>(
        &amp;self,
        untrusted_header: &amp;<a class="type" href="../../types/type.SignedHeader.html" title="type tendermint_light_client_verifier::types::SignedHeader">SignedHeader</a>,
        trusted_validators: &amp;<a class="type" href="../../types/type.ValidatorSet.html" title="type tendermint_light_client_verifier::types::ValidatorSet">ValidatorSet</a>,
        trust_threshold: <a class="type" href="../../types/type.TrustThreshold.html" title="type tendermint_light_client_verifier::types::TrustThreshold">TrustThreshold</a>,
        untrusted_validators: &amp;<a class="type" href="../../types/type.ValidatorSet.html" title="type tendermint_light_client_verifier::types::ValidatorSet">ValidatorSet</a>,
    ) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, <a class="struct" href="../../errors/struct.VerificationError.html" title="struct tendermint_light_client_verifier::errors::VerificationError">VerificationError</a>&gt; { ... }
<span class="item-spacer"></span>    fn <a href="#method.check_signers_overlap" class="fn">check_signers_overlap</a>(
        &amp;self,
        untrusted_header: &amp;<a class="type" href="../../types/type.SignedHeader.html" title="type tendermint_light_client_verifier::types::SignedHeader">SignedHeader</a>,
        untrusted_validators: &amp;<a class="type" href="../../types/type.ValidatorSet.html" title="type tendermint_light_client_verifier::types::ValidatorSet">ValidatorSet</a>,
    ) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, <a class="struct" href="../../errors/struct.VerificationError.html" title="struct tendermint_light_client_verifier::errors::VerificationError">VerificationError</a>&gt; { ... }
}</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Computes the voting power in a commit against a validator set.</p>
<p>This trait provides default implementation of some helper functions.</p>
</div></details><h2 id="required-methods" class="section-header">Required Methods<a href="#required-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="tymethod.voting_power_in" class="method"><a class="src rightside" href="../../../src/tendermint_light_client_verifier/operations/voting_power.rs.html#141-146">source</a><h4 class="code-header">fn <a href="#tymethod.voting_power_in" class="fn">voting_power_in</a>(
    &amp;self,
    signed_header: &amp;<a class="type" href="../../types/type.SignedHeader.html" title="type tendermint_light_client_verifier::types::SignedHeader">SignedHeader</a>,
    validator_set: &amp;<a class="type" href="../../types/type.ValidatorSet.html" title="type tendermint_light_client_verifier::types::ValidatorSet">ValidatorSet</a>,
    trust_threshold: <a class="type" href="../../types/type.TrustThreshold.html" title="type tendermint_light_client_verifier::types::TrustThreshold">TrustThreshold</a>,
) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="struct.VotingPowerTally.html" title="struct tendermint_light_client_verifier::operations::voting_power::VotingPowerTally">VotingPowerTally</a>, <a class="struct" href="../../errors/struct.VerificationError.html" title="struct tendermint_light_client_verifier::errors::VerificationError">VerificationError</a>&gt;</h4></section></summary><div class="docblock"><p>Compute the voting power in a header and its commit against a validator
set.</p>
<p>Note that the returned tally may be lower than actual tally so long as
it meets the <code>trust_threshold</code>.  Furthermore, the method isn’t
guaranteed to verify all the signatures present in the signed header.
If there are invalid signatures, the method may or may not return an
error depending on which validators those signatures correspond to.</p>
<p>If you have two separate sets of validators and need to check voting
power for both of them, prefer <a href="trait.VotingPowerCalculator.html#tymethod.voting_power_in_sets"><code>Self::voting_power_in_sets</code></a> method.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.voting_power_in_sets" class="method"><a class="src rightside" href="../../../src/tendermint_light_client_verifier/operations/voting_power.rs.html#178-183">source</a><h4 class="code-header">fn <a href="#tymethod.voting_power_in_sets" class="fn">voting_power_in_sets</a>(
    &amp;self,
    signed_header: &amp;<a class="type" href="../../types/type.SignedHeader.html" title="type tendermint_light_client_verifier::types::SignedHeader">SignedHeader</a>,
    first_set: (&amp;<a class="type" href="../../types/type.ValidatorSet.html" title="type tendermint_light_client_verifier::types::ValidatorSet">ValidatorSet</a>, <a class="type" href="../../types/type.TrustThreshold.html" title="type tendermint_light_client_verifier::types::TrustThreshold">TrustThreshold</a>),
    second_set: (&amp;<a class="type" href="../../types/type.ValidatorSet.html" title="type tendermint_light_client_verifier::types::ValidatorSet">ValidatorSet</a>, <a class="type" href="../../types/type.TrustThreshold.html" title="type tendermint_light_client_verifier::types::TrustThreshold">TrustThreshold</a>),
) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;(<a class="struct" href="struct.VotingPowerTally.html" title="struct tendermint_light_client_verifier::operations::voting_power::VotingPowerTally">VotingPowerTally</a>, <a class="struct" href="struct.VotingPowerTally.html" title="struct tendermint_light_client_verifier::operations::voting_power::VotingPowerTally">VotingPowerTally</a>), <a class="struct" href="../../errors/struct.VerificationError.html" title="struct tendermint_light_client_verifier::errors::VerificationError">VerificationError</a>&gt;</h4></section></summary><div class="docblock"><p>Compute the voting power in a header and its commit against two separate
validator sets.</p>
<p>This is equivalent to calling <a href="trait.VotingPowerCalculator.html#tymethod.voting_power_in"><code>Self::voting_power_in</code></a> on each set
separately but may be more optimised.  Implementators are encouraged to
write a properly optimised method which avoids checking the same
signature twice but for a simple unoptimised implementation the
following works:</p>

<div class="example-wrap ignore"><a href="#" class="tooltip" title="This example is not tested">ⓘ</a><pre class="rust rust-example-rendered"><code>    <span class="kw">fn </span>voting_power_in_sets(
        <span class="kw-2">&amp;</span><span class="self">self</span>,
        signed_header: <span class="kw-2">&amp;</span>SignedHeader,
        first_set: (<span class="kw-2">&amp;</span>ValidatorSet, TrustThreshold),
        second_set: (<span class="kw-2">&amp;</span>ValidatorSet, TrustThreshold),
    ) -&gt; <span class="prelude-ty">Result</span>&lt;(VotingPowerTally, VotingPowerTally), VerificationError&gt; {
        <span class="kw">let </span>first_tally = <span class="self">self</span>.voting_power_in(
            signed_header,
            first_set.<span class="number">0</span>,
            first_set.<span class="number">1</span>,
        )<span class="question-mark">?</span>;
        <span class="kw">let </span>second_tally = <span class="self">self</span>.voting_power_in(
            signed_header,
            first_set.<span class="number">0</span>,
            first_set.<span class="number">1</span>,
        )<span class="question-mark">?</span>;
        <span class="prelude-val">Ok</span>((first_tally, second_tally))
    }
</code></pre></div>
</div></details></div><h2 id="provided-methods" class="section-header">Provided Methods<a href="#provided-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="method.total_power_of" class="method"><a class="src rightside" href="../../../src/tendermint_light_client_verifier/operations/voting_power.rs.html#77-82">source</a><h4 class="code-header">fn <a href="#method.total_power_of" class="fn">total_power_of</a>(&amp;self, validator_set: &amp;<a class="type" href="../../types/type.ValidatorSet.html" title="type tendermint_light_client_verifier::types::ValidatorSet">ValidatorSet</a>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u64.html">u64</a></h4></section></summary><div class="docblock"><p>Compute the total voting power in a validator set</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.check_enough_trust_and_signers" class="method"><a class="src rightside" href="../../../src/tendermint_light_client_verifier/operations/voting_power.rs.html#97-116">source</a><h4 class="code-header">fn <a href="#method.check_enough_trust_and_signers" class="fn">check_enough_trust_and_signers</a>(
    &amp;self,
    untrusted_header: &amp;<a class="type" href="../../types/type.SignedHeader.html" title="type tendermint_light_client_verifier::types::SignedHeader">SignedHeader</a>,
    trusted_validators: &amp;<a class="type" href="../../types/type.ValidatorSet.html" title="type tendermint_light_client_verifier::types::ValidatorSet">ValidatorSet</a>,
    trust_threshold: <a class="type" href="../../types/type.TrustThreshold.html" title="type tendermint_light_client_verifier::types::TrustThreshold">TrustThreshold</a>,
    untrusted_validators: &amp;<a class="type" href="../../types/type.ValidatorSet.html" title="type tendermint_light_client_verifier::types::ValidatorSet">ValidatorSet</a>,
) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, <a class="struct" href="../../errors/struct.VerificationError.html" title="struct tendermint_light_client_verifier::errors::VerificationError">VerificationError</a>&gt;</h4></section></summary><div class="docblock"><p>Check that there is enough trust between an untrusted header and given
trusted and untrusted validator sets.</p>
<p>First of all, checks that enough validators from the
<code>trusted_validators</code> set signed the <code>untrusted_header</code> to reach given
<code>trust_threshold</code>.</p>
<p>Second of all, checks that enough validators from the
<code>untrusted_validators</code> set signed the <code>untrusted_header</code> to reach
a trust threshold of ⅔.</p>
<p>If both of those conditions aren’t met, it’s unspecified which error is
returned.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.check_signers_overlap" class="method"><a class="src rightside" href="../../../src/tendermint_light_client_verifier/operations/voting_power.rs.html#119-128">source</a><h4 class="code-header">fn <a href="#method.check_signers_overlap" class="fn">check_signers_overlap</a>(
    &amp;self,
    untrusted_header: &amp;<a class="type" href="../../types/type.SignedHeader.html" title="type tendermint_light_client_verifier::types::SignedHeader">SignedHeader</a>,
    untrusted_validators: &amp;<a class="type" href="../../types/type.ValidatorSet.html" title="type tendermint_light_client_verifier::types::ValidatorSet">ValidatorSet</a>,
) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, <a class="struct" href="../../errors/struct.VerificationError.html" title="struct tendermint_light_client_verifier::errors::VerificationError">VerificationError</a>&gt;</h4></section></summary><div class="docblock"><p>Check if there is 2/3rd overlap between an untrusted header and untrusted validator set</p>
</div></details></div><h2 id="implementors" class="section-header">Implementors<a href="#implementors" class="anchor">§</a></h2><div id="implementors-list"><section id="impl-VotingPowerCalculator-for-ProvidedVotingPowerCalculator%3CV%3E" class="impl"><a class="src rightside" href="../../../src/tendermint_light_client_verifier/operations/voting_power.rs.html#368-405">source</a><a href="#impl-VotingPowerCalculator-for-ProvidedVotingPowerCalculator%3CV%3E" class="anchor">§</a><h3 class="code-header">impl&lt;V: <a class="trait" href="../../../tendermint/crypto/signature/trait.Verifier.html" title="trait tendermint::crypto::signature::Verifier">Verifier</a>&gt; <a class="trait" href="trait.VotingPowerCalculator.html" title="trait tendermint_light_client_verifier::operations::voting_power::VotingPowerCalculator">VotingPowerCalculator</a> for <a class="struct" href="struct.ProvidedVotingPowerCalculator.html" title="struct tendermint_light_client_verifier::operations::voting_power::ProvidedVotingPowerCalculator">ProvidedVotingPowerCalculator</a>&lt;V&gt;</h3></section></div><script src="../../../trait.impl/tendermint_light_client_verifier/operations/voting_power/trait.VotingPowerCalculator.js" async></script></section></div></main></body></html>