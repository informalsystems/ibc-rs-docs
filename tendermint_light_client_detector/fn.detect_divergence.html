<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Given a primary trace and a witness, detect any divergence between the two, by querying the witness for the same header as the last header in the primary trace (ie. the target block), and comparing the hashes."><title>detect_divergence in tendermint_light_client_detector - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-b0742ba02757f159.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="tendermint_light_client_detector" data-themes="" data-resource-suffix="" data-rustdoc-version="1.84.0-nightly (9322d183f 2024-10-14)" data-channel="nightly" data-search-js="search-e056c65ede92db13.js" data-settings-js="settings-805db61a62df4bd2.js" ><script src="../static.files/storage-1d39b6787ed640ff.js"></script><script defer src="sidebar-items.js"></script><script defer src="../static.files/main-f070b9041d14864c.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-0111fcff984fae8f.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc fn"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../tendermint_light_client_detector/index.html">tendermint_<wbr>light_<wbr>client_<wbr>detector</a><span class="version">0.40.0</span></h2></div><div class="sidebar-elems"><div id="rustdoc-modnav"></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><span class="rustdoc-breadcrumbs"><a href="index.html">tendermint_light_client_detector</a></span><h1>Function <span class="fn">detect_divergence</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../src/tendermint_light_client_detector/detect.rs.html#37-112">source</a> </span></div><pre class="rust item-decl"><code>pub async fn detect_divergence&lt;H&gt;(
    primary: <a class="enum" href="https://doc.rust-lang.org/nightly/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;&amp;<a class="struct" href="struct.Provider.html" title="struct tendermint_light_client_detector::Provider">Provider</a>&gt;,
    witness: &amp;mut <a class="struct" href="struct.Provider.html" title="struct tendermint_light_client_detector::Provider">Provider</a>,
    primary_trace: <a class="struct" href="https://doc.rust-lang.org/nightly/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="struct" href="../tendermint_light_client_verifier/types/struct.LightBlock.html" title="struct tendermint_light_client_verifier::types::LightBlock">LightBlock</a>&gt;,
    max_clock_drift: <a class="struct" href="https://doc.rust-lang.org/nightly/core/time/struct.Duration.html" title="struct core::time::Duration">Duration</a>,
    max_block_lag: <a class="struct" href="https://doc.rust-lang.org/nightly/core/time/struct.Duration.html" title="struct core::time::Duration">Duration</a>,
) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="enum" href="https://doc.rust-lang.org/nightly/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;<a class="struct" href="struct.Divergence.html" title="struct tendermint_light_client_detector::Divergence">Divergence</a>&gt;, <a class="struct" href="struct.Error.html" title="struct tendermint_light_client_detector::Error">Error</a>&gt;<div class="where">where
    H: <a class="trait" href="../tendermint/crypto/sha256/trait.Sha256.html" title="trait tendermint::crypto::sha256::Sha256">Sha256</a> + <a class="trait" href="../tendermint/merkle/trait.MerkleHash.html" title="trait tendermint::merkle::MerkleHash">MerkleHash</a> + <a class="trait" href="https://doc.rust-lang.org/nightly/core/default/trait.Default.html" title="trait core::default::Default">Default</a>,</div></code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Given a primary trace and a witness, detect any divergence between the two,
by querying the witness for the same header as the last header in the primary trace
(ie. the target block), and comparing the hashes.</p>
<p>If the hashes match, then no divergence has been detected and the target block can be trusted.</p>
<p>If the hashes do not match, then the witness has provided a conflicting header.
This could possibly imply an attack on the light client.
In this case, we need to verify the witnessâ€™s header using the same skipping verification
and then we need to find the point that the headers diverge and examine this for any evidence of
an attack. We then attempt to find the bifurcation point and if successful construct the
evidence of an attack to report to the witness.</p>
</div></details></section></div></main></body></html>