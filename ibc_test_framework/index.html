<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="IBC Relayer Integration Test Framework"><title>ibc_test_framework - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-081576b923113409.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="ibc_test_framework" data-themes="" data-resource-suffix="" data-rustdoc-version="1.79.0-nightly (dbce3b43b 2024-04-20)" data-channel="nightly" data-search-js="search-bf21c90c8c1d92b1.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../static.files/storage-e32f0c247825364d.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-20a3ad099b048cf2.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-09095024cf37855e.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../ibc_test_framework/index.html">ibc_test_framework</a><span class="version">0.29.5</span></h2></div><div class="sidebar-elems"><ul class="block"><li><a id="all-types" href="all.html">All Items</a></li></ul><section><ul class="block"><li><a href="#modules">Modules</a></li></ul></section></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><div id="sidebar-button" tabindex="-1"><a href="../ibc_test_framework/all.html" title="show sidebar"></a></div><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Type ‘S’ or ‘/’ to search, ‘?’ for more options…" type="search"><div id="help-button" tabindex="-1"><a href="../help.html" title="help">?</a></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings">Settings</a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Crate <a class="mod" href="#">ibc_test_framework</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../src/ibc_test_framework/lib.rs.html#2-83">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h2 id="ibc-relayer-integration-test-framework"><a class="doc-anchor" href="#ibc-relayer-integration-test-framework">§</a>IBC Relayer Integration Test Framework</h2><h3 id="overview"><a class="doc-anchor" href="#overview">§</a>Overview</h3>
<p>The <code>ibc-test-framework</code> crate provides the infrastructure and framework for writing end-to-end (E2E) tests that include the spawning of the relayer together with Cosmos full nodes running as child processes inside the tests.</p>
<h3 id="installation"><a class="doc-anchor" href="#installation">§</a>Installation</h3>
<p>Other than Rust, the test suite assumes the <code>gaiad</code> binary is present in <code>$PATH</code>. You can install Gaia by either <a href="https://github.com/cosmos/gaia">building from source</a>, or load it using <a href="https://github.com/informalsystems/cosmos.nix/">Cosmos.nix</a>:</p>
<div class="example-wrap"><pre class="language-text"><code>nix shell github:informalsystems/cosmos.nix#gaia11
</code></pre></div>
<p>Alternatively, you can use <code>$CHAIN_COMMAND_PATH</code> to override with a different executable that is compatible with <code>gaiad</code>.</p>
<h3 id="examples"><a class="doc-anchor" href="#examples">§</a>Examples</h3>
<p>Example tests written using <code>ibc-test-framework</code> can be found in the <a href="https://github.com/informalsystems/hermes/tree/master/tools/integration-test"><code>ibc-rs</code> project repository</a></p>
<h3 id="diagrams"><a class="doc-anchor" href="#diagrams">§</a>Diagrams</h3>
<p>Some diagrams have been prepared to ease the understanding of the test framework:</p>
<ul>
<li><a href="https://app.excalidraw.com/l/4XqkU6POmGI/7za2eSTChuT">Tagged Identifiers and Data Structures</a></li>
<li><a href="https://app.excalidraw.com/l/4XqkU6POmGI/5y6i0NKqiEv">Test Data Structures</a></li>
<li><a href="https://app.excalidraw.com/l/4XqkU6POmGI/80KAnVZ6cu4">Test Framework Traits</a></li>
</ul>
<h3 id="overview-1"><a class="doc-anchor" href="#overview-1">§</a>Overview</h3>
<p>This IBC test framework gives developers working on relayer software in Rust a robust
yet flexible suite of functionality to test the correctness of their relayer implementations,
as well as verify the expected state of chains in response to relayed messages and packets.</p>
<h3 id="running-tests"><a class="doc-anchor" href="#running-tests">§</a>Running Tests</h3>
<p>We can run tests via the command line as follows:</p>
<div class="example-wrap"><pre class="language-bash"><code>RUST_LOG=info RUST_BACKTRACE=1 \
    cargo test -p ibc-integration-test --features example -- --test-threads=1 \
    example_test
</code></pre></div>
<p>The environment variable <code>RUST_LOG</code> controls log filtering for Hermes and,
besides the global log level, can be used to pass more elaborate directives
for the tracing framework. The <code>RUST_BACKTRACE</code> variable
displays a backtrace when errors occur in a test. The test flag <code>--test-threads=1</code> is
set so that tests are run serially (this makes it easier to follow what is going on
via the log output). Take a look at the <a href="types/config/struct.TestConfig.html" title="struct ibc_test_framework::types::config::TestConfig"><code>TestConfig</code></a>
type for more information about configuring how tests can be run.</p>
<p>For this example, we disable the test from running by default, since it calls the
<code>suspend</code> function and will thus never pass. We explicitly pass <code>--features example</code>
so that the <code>example</code> feature is activated such that this test will run. Finally, we
specify the name of the test so that <em>only</em> our example test is run.</p>
<p>After starting the test run, we may see logs such as the following:</p>
<div class="example-wrap"><pre class="language-text"><code>$ cargo test -p ibc-integration-test --features example -- --nocapture --test-threads=1 example_test
...
INFO created new chain/client/connection/channel from ibc-alpha-c4aed8f9/07-tendermint-4/connection-6/channel-1 to ibc-beta-fcb867bb/07-tendermint-6/connection-1/channel-6
INFO written channel environment to /path/to/ibc-rs/tools/integration-test/data/test-1094235493/binary-channels.env
WARN suspending the test indefinitely. you can still interact with any spawned chains and relayers
...
</code></pre></div>
<p>The INFO lines are notifying us of the path environment variables exported by the test.
The WARN line states that the test has been suspended indefinitely, as we knew it would.
Note that the chains are created with random IDs and are listening on random ports.</p>
<p>Using the logs, we can for example use <code>gaiad</code> to query for the balance of the accounts
created by the test by running:</p>
<div class="example-wrap"><pre class="language-bash"><code>$ source /path/to/ibc-rs/tools/integration-test/data/test-1094235493/binary-channels.env
$ gaiad --home &quot;$NODE_A_HOME&quot; --node $NODE_A_RPC_ADDR query bank balances $NODE_A_WALLETS_USER1_ADDRESS
balances:
- amount: &quot;6902395390297&quot;
denom: coin95143d31
- amount: &quot;6902395390297&quot;
denom: stake
pagination:
next_key: null
total: &quot;0&quot;
</code></pre></div>
<p>The test data and configuration files are stored at the absolute path shown in the
log, which looks something like <code>/path/to/ibc-rs/tools/integration-test/data/test-1094235493</code>.
The sub-directory <code>test-1094235493</code> is randomly generated at the beginning of a test
case such that all data related to that test lives in the same directory.</p>
</div></details><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="bootstrap/index.html" title="mod ibc_test_framework::bootstrap">bootstrap</a></div><div class="desc docblock-short">Helper functions for setting up test cases in an imperative way.</div></li><li><div class="item-name"><a class="mod" href="chain/index.html" title="mod ibc_test_framework::chain">chain</a></div><div class="desc docblock-short">Constructs for spawning and managing full nodes, e.g. the
Gaia chains.</div></li><li><div class="item-name"><a class="mod" href="docs/index.html" title="mod ibc_test_framework::docs">docs</a></div><div class="desc docblock-short">Documentation-only module containing long-form docs and walkthroughs.</div></li><li><div class="item-name"><a class="mod" href="error/index.html" title="mod ibc_test_framework::error">error</a></div><div class="desc docblock-short">Error type used for the tests.</div></li><li><div class="item-name"><a class="mod" href="framework/index.html" title="mod ibc_test_framework::framework">framework</a></div><div class="desc docblock-short">Framework code for making it easier to write test cases.</div></li><li><div class="item-name"><a class="mod" href="ibc/index.html" title="mod ibc_test_framework::ibc">ibc</a></div><div class="desc docblock-short">Code that may belong to the <code>ibc</code> module, but are currently
in this crate for easier review or maintenance.</div></li><li><div class="item-name"><a class="mod" href="prelude/index.html" title="mod ibc_test_framework::prelude">prelude</a></div><div class="desc docblock-short">Re-export of common constructs that are used by test cases.</div></li><li><div class="item-name"><a class="mod" href="relayer/index.html" title="mod ibc_test_framework::relayer">relayer</a></div><div class="desc docblock-short">Code that may belong to the <a href="../ibc_relayer/index.html" title="mod ibc_relayer"><code>ibc_relayer</code></a> module, but are currently
in this crate for easier review or maintenance.</div></li><li><div class="item-name"><a class="mod" href="types/index.html" title="mod ibc_test_framework::types">types</a></div><div class="desc docblock-short">This module contains definitions of core data structures that are used
in the test suite.</div></li><li><div class="item-name"><a class="mod" href="util/index.html" title="mod ibc_test_framework::util">util</a></div><div class="desc docblock-short">Utility and helper functions used in the tests.</div></li></ul></section></div></main></body></html>