<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Storage and management of chain state, backed by Jellyfish Merkle Trees and RocksDB."><title>cnidarium - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-b0742ba02757f159.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="cnidarium" data-themes="" data-resource-suffix="" data-rustdoc-version="1.84.0-nightly (9322d183f 2024-10-14)" data-channel="nightly" data-search-js="search-e056c65ede92db13.js" data-settings-js="settings-805db61a62df4bd2.js" ><script src="../static.files/storage-1d39b6787ed640ff.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-f070b9041d14864c.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-0111fcff984fae8f.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../cnidarium/index.html">cnidarium</a><span class="version">0.83.0</span></h2></div><div class="sidebar-elems"><ul class="block"><li><a id="all-types" href="all.html">All Items</a></li></ul><section id="rustdoc-toc"><h3><a href="#modules">Crate Items</a></h3><ul class="block"><li><a href="#modules" title="Modules">Modules</a></li><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#traits" title="Traits">Traits</a></li><li><a href="#functions" title="Functions">Functions</a></li></ul></section><div id="rustdoc-modnav"></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Crate <span>cnidarium</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../src/cnidarium/lib.rs.html#1-94">source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Storage and management of chain state, backed by Jellyfish Merkle Trees and RocksDB.</p>
<p>This crate provides a versioned, verifiable key-value store that also
supports lightweight, copy-on-write snapshots and transactional semantics.
The <a href="struct.Storage.html" title="struct cnidarium::Storage"><code>Storage</code></a> type is a handle for an instance of a backing store,
implemented using RocksDB.  The storage records a sequence of versioned
<a href="struct.Snapshot.html" title="struct cnidarium::Snapshot"><code>Snapshot</code></a>s.  The <a href="struct.Snapshot.html" title="struct cnidarium::Snapshot"><code>Snapshot</code></a> type is a lightweight snapshot of a particular
version of the chain state.</p>
<p>Each <a href="struct.Snapshot.html" title="struct cnidarium::Snapshot"><code>Snapshot</code></a> instance can also be used as the basis for a copy-on-write
fork to build up changes before committing them to persistent storage.  The
<a href="struct.StateDelta.html" title="struct cnidarium::StateDelta"><code>StateDelta</code></a> type collects a group of writes, which can then be applied to
the (in-memory) <a href="struct.StateDelta.html" title="struct cnidarium::StateDelta"><code>StateDelta</code></a> overlay.  Finally, the changes accumulated in the
<a href="struct.StateDelta.html" title="struct cnidarium::StateDelta"><code>StateDelta</code></a> instance can be committed to the persistent <a href="struct.Storage.html" title="struct cnidarium::Storage"><code>Storage</code></a>.</p>
<p>Reads are performed with the <a href="trait.StateRead.html" title="trait cnidarium::StateRead"><code>StateRead</code></a> trait, implemented by both
<a href="struct.Snapshot.html" title="struct cnidarium::Snapshot"><code>Snapshot</code></a> and <a href="struct.StateDelta.html" title="struct cnidarium::StateDelta"><code>StateDelta</code></a>, and reflect any currently cached writes.
Writes are performed with the <a href="trait.StateWrite.html" title="trait cnidarium::StateWrite"><code>StateWrite</code></a> trait, which is only
implemented for <a href="struct.StateDelta.html" title="struct cnidarium::StateDelta"><code>StateDelta</code></a>.</p>
<p>The storage system provides three data stores:</p>
<ul>
<li>
<p>A verifiable key-value store, with UTF-8 keys and byte values, backed by
the Jellyfish Merkle Tree.  The JMT is a sparse merkle tree that records
hashed keys, so we also record an index of the keys themselves to allow
range queries on keys rather than key hashes. This index, however, is not
part of the verifiable consensus state.</p>
</li>
<li>
<p>A secondary, non-verifiable key-value store with byte keys and byte
values, backed directly by RocksDB.  This is intended for use building
application-specific indexes of the verifiable consensus state.</p>
</li>
<li>
<p>A tertiary, in-memory object store. This is intended for use implementing
accumulators, like lists of data to be batch-processed at the end of the
block.  The object store clones on read to prevent violations of
transactional semantics, so it should be used with immutable data structures
like those in the <code>im</code> crate that implement copy-on-write behavior
internally.</p>
</li>
</ul>
<p>The storage system also supports prefixed “substores”, somewhat similar to
the Cosmos SDK’s multistore design. Each substore has a separate JMT, whose
root hash is written into the base store under the prefix.  This allows use
cases like storing IBC data in a subtree.  The substore’s non-verifiable
store is also stored in a separate RocksDB column family, allowing storage
optimizations.</p>
<p>Remember that the chain state is a public API.  Mapping from raw byte values
to typed data should be accomplished by means of extension traits.  For
instance, the <code>penumbra_proto</code> crate provides an extension trait to
automatically (de)serialize into proto or domain types, allowing its use as
an object store.</p>
<p>With the <code>rpc</code> feature enabled, this crate also provides a GRPC interface to
the key-value store using Tonic.</p>
</div></details><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="future/index.html" title="mod cnidarium::future">future</a></div><div class="desc docblock-short">Concrete futures types used by the storage crate.</div></li><li><div class="item-name"><a class="mod" href="proto/index.html" title="mod cnidarium::proto">proto</a><wbr><span class="stab portability" title="Available on crate feature `proto` only"><code>proto</code></span></div></li><li><div class="item-name"><a class="mod" href="rpc/index.html" title="mod cnidarium::rpc">rpc</a><wbr><span class="stab portability" title="Available on crate feature `rpc` only"><code>rpc</code></span></div></li></ul><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.Cache.html" title="struct cnidarium::Cache">Cache</a></div><div class="desc docblock-short">A cache of changes to the state of the blockchain.</div></li><li><div class="item-name"><a class="struct" href="struct.EscapedByteSlice.html" title="struct cnidarium::EscapedByteSlice">Escaped<wbr>Byte<wbr>Slice</a></div><div class="desc docblock-short">A wrapper type for a byte slice that implements <code>Debug</code> by escaping
non-printable bytes.</div></li><li><div class="item-name"><a class="struct" href="struct.RootHash.html" title="struct cnidarium::RootHash">Root<wbr>Hash</a></div><div class="desc docblock-short">A root of a <a href="../jmt/tree/struct.JellyfishMerkleTree.html" title="struct jmt::tree::JellyfishMerkleTree"><code>JellyfishMerkleTree</code></a>.</div></li><li><div class="item-name"><a class="struct" href="struct.Snapshot.html" title="struct cnidarium::Snapshot">Snapshot</a></div><div class="desc docblock-short">A snapshot of the underlying storage at a specific state version, suitable
for read-only access by multiple threads, e.g., RPC calls.</div></li><li><div class="item-name"><a class="struct" href="struct.StagedWriteBatch.html" title="struct cnidarium::StagedWriteBatch">Staged<wbr>Write<wbr>Batch</a></div><div class="desc docblock-short">A staged write batch that can be committed to RocksDB.</div></li><li><div class="item-name"><a class="struct" href="struct.StateDelta.html" title="struct cnidarium::StateDelta">State<wbr>Delta</a></div><div class="desc docblock-short">An arbitrarily-deeply nested stack of delta updates to an underlying state.</div></li><li><div class="item-name"><a class="struct" href="struct.Storage.html" title="struct cnidarium::Storage">Storage</a></div><div class="desc docblock-short">A handle for a storage instance, backed by RocksDB.</div></li><li><div class="item-name"><a class="struct" href="struct.TempStorage.html" title="struct cnidarium::TempStorage">Temp<wbr>Storage</a></div><div class="desc docblock-short">A <a href="struct.Storage.html" title="struct cnidarium::Storage"><code>Storage</code></a> instance backed by a <a href="../tempfile/dir/struct.TempDir.html" title="struct tempfile::dir::TempDir"><code>tempfile::TempDir</code></a> for testing.</div></li></ul><h2 id="traits" class="section-header">Traits<a href="#traits" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="trait" href="trait.ArcStateDeltaExt.html" title="trait cnidarium::ArcStateDeltaExt">ArcState<wbr>Delta<wbr>Ext</a></div><div class="desc docblock-short">Extension trait providing <code>try_begin_transaction()</code> on <code>Arc&lt;StateDelta&lt;S&gt;&gt;</code>.</div></li><li><div class="item-name"><a class="trait" href="trait.StateRead.html" title="trait cnidarium::StateRead">State<wbr>Read</a></div><div class="desc docblock-short">Read access to chain state.</div></li><li><div class="item-name"><a class="trait" href="trait.StateWrite.html" title="trait cnidarium::StateWrite">State<wbr>Write</a></div><div class="desc docblock-short">Write access to chain state.</div></li></ul><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.ics23_spec.html" title="fn cnidarium::ics23_spec">ics23_<wbr>spec</a></div></li><li><div class="item-name"><a class="fn" href="fn.register_metrics.html" title="fn cnidarium::register_metrics">register_<wbr>metrics</a><wbr><span class="stab portability" title="Available on crate feature `metrics` only"><code>metrics</code></span></div><div class="desc docblock-short">Registers all metrics used by this crate.</div></li></ul></section></div></main></body></html>